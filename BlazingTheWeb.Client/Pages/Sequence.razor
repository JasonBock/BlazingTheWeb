@using BlazingTheWeb.Core
@using System.Numerics

@page "/sequence"

<h1>Sequence</h1>

<p>Calculations are being made at:</p>
<ul>
    @*<li>Latitude: @location?.Latitude</li>
    <li>Longitude: @location?.Longitude</li>
    <li>Accuracy: @location?.Accuracy</li>*@
</ul>
<!--From https://www.bing.com/maps/embed-a-map-->
<div>
    <iframe width="500" height="400" frameborder="0" src="@bingMainUrl" scrolling="no"></iframe>
    <div style="white-space: nowrap; text-align: center; width: 500px; padding: 6px 0;">
        <a id="largeMapLink" href="@bingLargeMapUrl" target="_blank">View Larger Map</a> &nbsp; | &nbsp;
        <a id="dirMapLink" href="@bingDirectionsUrl" target="_blank">Get Directions</a>
    </div>
</div>

<p>Current sequence: @currentSequence</p>
<input type="text" bind="@value" />
<button class="btn btn-primary" onclick="@CreateSequence">Create Sequence</button>

@functions {
   string value = string.Empty;
   string currentSequence = string.Empty;
   string bingMainUrl = default;
   string bingLargeMapUrl = default;
   string bingDirectionsUrl = default;

   void CreateSequence()
   {
       if (BigInteger.TryParse(this.value, out var value))
       {
           try
           {
               var sequence = new CollatzSequence(value);
               this.currentSequence = string.Join(", ", sequence.Sequence);
           }
           catch(ArgumentException)
           {
               this.currentSequence = $"The value, {value}, is incorrect.";
           }
       }
       else
       {
           this.currentSequence = $"{this.value} is not a valid integer.";
       }
   }
}
